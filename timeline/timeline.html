<!DOCTYPE html>
<html>
<body>

<canvas id="canvas"></canvas>
<canvas id="coloredArea"></canvas>

<script>
Number.prototype.toMMSS = function () {
    var sec_num = parseInt(this, 10);
    var minutes = Math.floor(sec_num / 60);
    var seconds = sec_num - (minutes * 60);

    if (seconds < 10) {seconds = "0"+seconds;}
    var time = minutes+':'+seconds;
    return time;
}

// constants
const widthTimeline = 1500;
const widthPadding = 20;
const widthCanvas = widthTimeline + 2*widthPadding;
const height = 40;
const heightTimeline = height / 4;
const rangeFrom = 25;
const rangeTo = 50;
const videoLength = 597;
const heightTimestampsLine = 20;

// global variables
var timeRanges;
var timestampsOffset;

function createTimeline() {
  var canvas = document.getElementById("canvas");
  var context = canvas.getContext("2d");
	context.canvas.width  = widthCanvas;
	context.canvas.height = height;

	// Fill the horizontal line
	context.fillStyle = "#9ea7b8";
	context.fillRect(widthPadding,0,widthTimeline,heightTimeline);
	context.fillStyle = "black";
  context.font = "bold 13px Arial";
  canvas.style.opacity = 0.7;

	if (videoLength >= 600) {
		timeRanges = 30;
	} else {
		timeRanges = 20;
	}

	var x = 0;
	var y = 0;

	// create the timestamp every 20 oder 30 seconds
	var numTimestamps = videoLength / timeRanges;
	timestampsOffset = widthTimeline / numTimestamps;
	var offset = widthPadding;
	for (var timestamp=0; timestamp <= videoLength; timestamp += timeRanges) {
		// write timestamp on timeline
		context.fillText(timestamp.toMMSS(), offset - 10, height/3 + 20);

		// draw line to corresponding timestamp
		context.beginPath();
		context.moveTo(offset,0);
		context.lineTo(offset,heightTimestampsLine);
		context.stroke();

		// draw midline in between two timestamps
		if (offset + timestampsOffset/2 < widthTimeline + widthPadding) {
			context.beginPath();
			context.moveTo(offset + timestampsOffset/2,0);
			context.lineTo(offset + timestampsOffset/2,heightTimeline);
			context.stroke();
		}
		offset = offset + timestampsOffset;
	}

  // lastTimestamp
	context.fillText(videoLength.toMMSS(), (widthTimeline + widthPadding) - 10, height/3 + 20);

  // last line to corresponding timestamp
  context.beginPath();
  context.moveTo((widthTimeline + widthPadding),0);
  context.lineTo((widthTimeline + widthPadding),heightTimestampsLine);
  context.stroke();

}

function colorTimeline(fromSeconds, toSeconds) {
  // reset the timeline to original
  document.getElementById("canvas").getContext("2d").clearRect(0, 0, widthCanvas, height);
  createTimeline();

  // TODO use a different canvas
  var coloredArea = document.getElementById("canvas");
  var context2 = coloredArea.getContext("2d");

  // get the positions in the timeline
  var fromX = widthPadding + (fromSeconds/timeRanges * timestampsOffset);
  var toX = widthPadding + (toSeconds/timeRanges * timestampsOffset);

  // Fill the horizontal line
  context2.fillStyle = "#004CB3";
  context2.globalAlpha = 0.9;
  context2.fillRect(parseInt(fromX),0,parseInt(toX - fromX),heightTimeline);
  context2.globalAlpha = 1.0;
}

createTimeline();
colorTimeline(210, 230);
</script>

</body>
</html>
